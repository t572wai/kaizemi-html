<!DOCTYPE html>
<html lang="jp" dir="ltr">
	<head>
		<meta charset="utf-8">
		<meta name="robots" content="noindex"/>
		<title>轢きたかし</title>
		<script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
		<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
		<script type="text/javascript">
			let rates = {};
			let players = new Array();

			$(function () {
				console.log("start");
				$('#players').sortable();
			});

			$(function () {
				$("#CannotAddPlayerDialog").dialog({
					autoOpen:false,
					modal:false
				})
				$('#addPlayerDialog').dialog({
					autoOpen: false,
					modal: true,
					buttons: [
						{
							text: "追加",
							click: function () {
								let newPlayerName = $('#newPlayerName').val();
								if(newPlayerName!=null && newPlayerName!=""){
									players.push(newPlayerName);
									rates[newPlayerName]=$('#newPlayerRate').val();
									$(this).dialog('close');
									updateDate();
								}else {
									console.log(newPlayerName);
									$('#CannotAddPlayerDialog').dialog('open');
								}
							}
						}
					]
				})
			})

			function updateDate() {
				let playersHTML = "";
				for (name of players) {
					playersHTML += '<li>'+name+'</li>';
				}
				players.sort(function (a,b) {
					if(rates[a]<rates[b]) return -1;
					if(rates[a]>rates[b]) return 1;
					return 0;
				});
				console.log(rates);
				console.log(players);
				let ratesHTML = "";
				let i = 1;
				let beforeRate = 0;
				for(name of players){
					let rank;
					if(beforeRate!=rates[name]){
						rank = i++;
					}else {
						rank = --i;
						i++;
					}
					beforeRate = rates;
					ratesHTML += rank + '位:' + name + " レート:" + rates[name] + '<br>';
				}
				$('#rates').html(ratesHTML);
				$('#players').html(playersHTML);
			}

			function addPlayer() {
				$('#addPlayerDialog').dialog('open');
			}
		</script>
		<style>
			.Dialog{
				display: none;
			}
		</style>
	</head>
	<body>
		<h1>轢きたかし用レート計算機</h1>
		<button type="button" onclick="addPlayer();">プレイヤーの追加</button>

		<div id="rates">
		</div>
		<ul id="players">
		</ul>

		<div id="addPlayerDialog" class="Dialog" title="プレイヤーの追加">
			プレイヤーを追加<br>
			名前　<input type="text" value="" id="newPlayerName"><br>
			レート<input type="number" value="1.0" step="0.1" id="newPlayerRate">
		</div>

		<div id="CannotAddPlayerDialog" class="Dialog" title="エラー">
			プレイヤーを追加できません
		</div>
	</body>
</html>
